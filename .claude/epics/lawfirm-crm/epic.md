---
name: lawfirm-crm
status: backlog
created: 2025-09-02T09:56:04Z
progress: 0%
prd: .claude/prds/lawfirm-crm.md
github: https://github.com/fakechris/lawcase-bench/issues/2
---

# Epic: lawfirm-crm

## Overview

基于Next.js + Node.js + PostgreSQL技术栈，构建一个面向律师事务所的全生命周期CRM系统。系统采用微服务架构设计，通过角色化工作台实现营销、销售、律师、财务等多角色协同工作，支持从线索获取到案件结案的完整业务流程数字化管理。

## Architecture Decisions

### 核心架构选择

- **单体应用起步**：采用Monorepo结构，前后端分离但统一部署，降低初期复杂度
- **渐进式演进**：预留微服务拆分点，未来可根据需要拆分为独立服务
- **状态管理**：前端使用React Query管理服务端状态， Zustand管理客户端状态
- **认证授权**：采用JWT + Refresh Token机制，基于角色的访问控制(RBAC)

### 数据层设计

- **主数据库**：PostgreSQL作为主数据存储
- **文档存储**：案件相关文档使用MinIO/S3对象存储
- **缓存层**：Redis缓存会话和频繁访问数据
- **搜索功能**：PostgreSQL全文搜索，后期可扩展Elasticsearch

### API设计

- **RESTful API**：主要业务接口采用REST风格
- **GraphQL**：报表分析模块使用GraphQL提升查询灵活性
- **WebSocket**：实时通知和状态更新
- **文件上传**：支持分片上传和断点续传

## Technical Approach

### Frontend Components

#### 核心页面结构

- **登录页**：支持双因子认证
- **仪表盘**：角色化的数据看板和待办事项
- **客户360°视图**：客户全生命周期信息统一展示
- **案件详情页**：案件进度、文档、时间线管理
- **报表中心**：多维度数据分析和可视化

#### 关键UI组件

- **角色化工作台**：基于用户角色动态渲染界面
- **状态机组件**：可视化的客户/案件状态流转
- **时间线组件**：客户交互历史时间轴
- **文档预览**：支持多种格式文档在线预览
- **富文本编辑器**：案件记录和合同模板编辑

#### 状态管理策略

- **全局状态**：用户信息、权限、系统配置
- **页面状态**：表单数据、筛选条件、分页信息
- **缓存策略**：API响应缓存、离线数据支持

### Backend Services

#### 核心服务模块

- **用户服务**：认证、授权、用户管理
- **线索服务**：线索创建、分配、转化
- **客户服务**：客户信息、标签、沟通记录
- **案件服务**：案件生命周期管理
- **合同服务**：合同模板、签署、执行
- **财务服务**：收款、退款、报表
- **通知服务**：邮件、短信、站内消息
- **文件服务**：文档上传、存储、预览

#### 数据模型设计

```typescript
// 核心实体关系
User -> Role -> Permission
Lead -> Customer -> Case -> Contract
Case -> Document -> Hearing -> Judgment
Customer -> Payment -> Refund
```

#### 业务规则引擎

- **线索分配规则**：基于负载、技能、地域的自动分配
- **SLA监控**：24小时响应时间预警
- **状态流转**：客户和案件状态机管理
- **权限校验**：数据访问权限控制

### Infrastructure

#### 部署架构

- **容器化**：Docker + Docker Compose开发环境
- **生产环境**：Kubernetes集群部署
- **CI/CD**：GitHub Actions自动化部署
- **监控告警**：Prometheus + Grafana + AlertManager

#### 数据备份策略

- **数据库**：每日全量备份 + 实时WAL归档
- **文件存储**：多区域副本 + 版本控制
- **配置备份**：Git管理的配置文件

#### 安全措施

- **数据加密**：传输层SSL + 存储层加密
- **访问控制**：VPN + 白名单IP限制
- **审计日志**：所有操作留痕记录
- **漏洞扫描**：定期安全检查

## Implementation Strategy

### 开发阶段划分

#### 第一阶段（8周）：MVP核心功能

1. **基础设施搭建**
   - 项目初始化和开发环境配置
   - 数据库设计和基础模型
   - 认证授权系统实现
   - 基础UI组件库建设

2. **线索管理**
   - 线索录入和分配功能
   - 市场人员工作台
   - 基础报表功能

#### 第二阶段（6周）：客户与案件管理

1. **客户管理**
   - 客户信息管理
   - 沟通记录跟踪
   - 客户360°视图

2. **案件管理**
   - 案件创建和分配
   - 进度跟踪功能
   - 文档管理系统

#### 第三阶段（6周）：财务与合同

1. **合同管理**
   - 合同模板管理
   - 电子签署集成
   - 合同执行跟踪

2. **财务管理**
   - 收款管理
   - 财务报表
   - 成本核算

#### 第四阶段（4周）：优化与上线

1. **性能优化**
   - 前端性能优化
   - 数据库查询优化
   - 缓存策略优化

2. **上线准备**
   - 数据迁移
   - 用户培训
   - 生产环境部署

### 风险缓解措施

- **技术风险**：关键技术预研和POC验证
- **进度风险**：采用敏捷开发，每周交付可用版本
- **质量风险**：自动化测试覆盖，代码审查机制
- **用户接受度**：早期用户参与，持续收集反馈

## Tasks Created

- [ ] #3 - 项目初始化和环境搭建 (parallel: true)
- [ ] #4 - 数据库设计和核心模型实现 (parallel: false)
- [ ] #5 - 认证授权系统实现 (parallel: false)
- [ ] #6 - 线索管理功能开发 (parallel: true)
- [ ] #7 - 客户管理和360°视图 (parallel: true)
- [ ] #8 - 案件全生命周期管理 (parallel: true)
- [ ] #9 - 角色化工作台开发 (parallel: true)
- [ ] #10 - 合同管理系统开发 (parallel: true)
- [ ] #11 - 财务管理和报表系统 (parallel: true)
- [ ] #12 - 第三方服务集成 (parallel: true)

Total tasks: 10
Parallel tasks: 8
Sequential tasks: 2
Estimated total effort: 768 hours (96 person-days)

## Task Breakdown Preview

- [ ] **项目初始化**：搭建开发环境，配置CI/CD流程
- [ ] **数据库设计**：设计并实现核心数据模型
- [ ] **认证系统**：实现用户认证和权限管理
- [ ] **线索管理**：开发线索创建、分配、跟进功能
- [ ] **客户管理**：构建客户信息管理和360°视图
- [ ] **案件管理**：实现案件全生命周期管理
- [ ] **工作台开发**：开发角色化的工作台界面
- [ ] **报表系统**：构建数据分析和可视化报表
- [ ] **第三方集成**：集成电话、短信、电子签名等服务
- [ ] **性能优化**：系统性能调优和安全加固

## Dependencies

### 外部依赖

- **电话系统API**：通话集成和录音功能
- **短信网关**：验证码和通知短信
- **电子签名服务**：合同在线签署
- **支付网关**：在线收款功能
- **邮件服务**：系统邮件发送

### 内部依赖

- **UI设计稿**：界面设计和交互原型
- **业务流程文档**：详细的业务流程说明
- **测试数据**：开发和测试所需的数据样本
- **运维支持**：生产环境部署和监控

## Success Criteria (Technical)

### 性能指标

- 页面加载时间 < 2秒（95分位）
- API响应时间 < 500ms（95分位）
- 支持100并发用户无性能下降
- 文件上传支持断点续传

### 质量标准

- 单元测试覆盖率 > 80%
- 集成测试覆盖核心流程
- E2E测试覆盖主要用户场景
- 代码审查通过率100%

### 安全要求

- 通过OWASP Top 10安全扫描
- 敏感数据100%加密存储
- 完整的操作审计日志
- 定期安全漏洞修复

## Estimated Effort

### 时间估算

- **总工期**：24周（6个月）
- **开发团队**：1名PM + 1名架构师 + 4名开发 + 1名测试 + 1名UI
- **关键路径**：认证系统 → 线索管理 → 客户管理 → 案件管理

### 资源需求

- **开发环境**：本地开发环境 + 测试服务器
- **第三方服务**：API服务和云资源预算
- **培训资源**：用户培训和文档编写

### 里程碑

- **W4**：完成基础设施和认证系统
- **W8**：MVP版本上线测试
- **W14**：核心功能全部完成
- **W20**：系统集成测试完成
- **W24**：正式上线运行
